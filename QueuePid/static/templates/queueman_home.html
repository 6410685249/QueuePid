{% extends 'layout.html' %}
{% load static %}

{% block header %}
    Home
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/queue_home.css' %}" />
{% endblock %}

{% block body %}
    {% block navigation %}{% endblock %}
    {% include 'nav_queue.inc.html' %}

    <div class="container">
        <div class="profile-area">
            <img src="{% static 'img/default_avatar.png' %}" alt="avatar">
        </div>
        <div class="account-area">
            <h2>Username: {{ queueman.username }}</h2>
            <p>Your credit remaining: {{ queueman.credit }}</p>
        </div>
    </div>

    <h3>Customer list</h3>
    {% if queueman.is_have_queue == False %}
    <table>
        {% for customer in clist %}
            <td class="container">
                <div class="profile-area">
                    <img src="{% static 'img/default_avatar.png' %}" alt="avatar">
                </div>
                <div>
                    <form action="{% url 'get_queue' %}" method="post" id="gq">
                        {% csrf_token %}
                        <p> Username: {{ customer.customer_username }} </p>
                        <p> Restaurant: {{ customer.restaurant }}</p>
                        <p> Distance: {{ distance }}</p>
                        <input type="hidden" name="customer" value="{{customer.customer_username}}">
                        <input type="hidden" name="restaurant" value="{{customer.restaurant }}">
                        <a onclick="myFunction()" class="hover">Get Queue</a>
                    </form>
                </div>
            </td>
        {% endfor %}
    </table>
    {% else %}
    <h4> Please finish your first queue before take another queue</h4>
    {% endif %}
    

    {% if finish_m %}
        <h1>{{ finish_m }}</h1>
    {% endif %}

    <script> 
        function myFunction() { 
            document.getElementById("gq").submit(); 
        } 
    </script> 

    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
         } else {
            }
        }

        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            // Send AJAX request to Django view
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/queueman/home/', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send('latitude=' + latitude + '&longitude=' + longitude);
        }

        window.onload = function() {
            getLocation();
        }

    </script>

{% endblock %}